set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(10, 0.5)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative2_priors_beta <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(20, 1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
diffuse_priors_gamma <- c(
prior(normal(0, 1000000), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative1_priors_gamma <- c(
prior(normal(0, 100), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative2_priors_gamma <- c(
prior(normal(0, 1), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
#----------------------------------------------------------
# ✅ Select the correct prior set based on inputs
#----------------------------------------------------------
if (family == "beta") {
priors <- switch(priorType,
"d"   = diffuse_priors_beta,
"wi1" = weaklyInformative1_priors_beta,
"wi2" = weaklyInformative2_priors_beta)
} else if (family == "gamma") {
priors <- switch(priorType,
"d"   = diffuse_priors_gamma,
"wi1" = weaklyInformative1_priors_gamma,
"wi2" = weaklyInformative2_priors_gamma)
}
#----------------------------------------------------------
# ✅ Adjust prior list for model structure
#----------------------------------------------------------
if (isTRUE(interceptOnly)) {
# Remove priors for fixed effects and correlations
priors <- priors[!sapply(priors, function(p) p$class %in% c("b", "cor"))]
} else if (isTRUE(randomSlope)) {
# Remove only correlation priors
priors <- priors[!sapply(priors, function(p) p$class == "cor")]
}
#----------------------------------------------------------
# ✅ Return the final cleaned prior list
#----------------------------------------------------------
return(priors)
}
options(brms.verbose = FALSE)
makePrior <- function(family = "beta", priorType = "d", interceptOnly = FALSE, randomSlope = FALSE) {
#----------------------------------------------------------
# ✅ Input hints and validation
#----------------------------------------------------------
allowed_families <- c("beta", "gamma")
allowed_prior_types <- c("d", "wi1", "wi2")
if (!family %in% allowed_families) {
stop(paste0(
"❌ Invalid 'family' argument.\n",
"Allowed values: ", paste(allowed_families, collapse = ", ")
))
}
if (!priorType %in% allowed_prior_types) {
stop(paste0(
"❌ Invalid 'priorType' argument.\n",
"Allowed values: ", paste(allowed_prior_types, collapse = ", ")
))
}
#----------------------------------------------------------
# ✅ Define all priors (copied from your definitions)
#----------------------------------------------------------
diffuse_priors_beta <- c(
set_prior("normal(0, 1000000)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(2, 0.1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative1_priors_beta <- c(
set_prior("normal(0, 100)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(10, 0.5)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative2_priors_beta <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(20, 1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
diffuse_priors_gamma <- c(
prior(normal(0, 1000000), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative1_priors_gamma <- c(
prior(normal(0, 100), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative2_priors_gamma <- c(
prior(normal(0, 1), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
#----------------------------------------------------------
# ✅ Select the correct prior set based on inputs
#----------------------------------------------------------
if (family == "beta") {
priors <- switch(priorType,
"d"   = diffuse_priors_beta,
"wi1" = weaklyInformative1_priors_beta,
"wi2" = weaklyInformative2_priors_beta)
} else if (family == "gamma") {
priors <- switch(priorType,
"d"   = diffuse_priors_gamma,
"wi1" = weaklyInformative1_priors_gamma,
"wi2" = weaklyInformative2_priors_gamma)
}
#----------------------------------------------------------
# ✅ Adjust prior list for model structure
#----------------------------------------------------------
if (isTRUE(interceptOnly)) {
# Remove priors for fixed effects and correlations
priors <- priors[!sapply(priors, function(p) p$class %in% c("b", "cor"))]
} else if (isTRUE(randomSlope)) {
# Remove only correlation priors
priors <- priors[!sapply(priors, function(p) p$class == "cor")]
}
#----------------------------------------------------------
# ✅ Return the final cleaned prior list
#----------------------------------------------------------
return(priors)
}
options(brms.verbose = FALSE)
load("~/Library/CloudStorage/OneDrive-TheUniversityofMelbourne/Bayesian Updating and Complexity/Code/Analysis/R/BR_v1.RData")
load("~/Library/CloudStorage/OneDrive-TheUniversityofMelbourne/Bayesian Updating and Complexity/Code/Analysis/R/BR_v1.RData")
print(summary(r9_rs_diffuse))
print(summary(r9_rs_diffuse))
print(summary(r9_diffuse_rs))
posteriorPredictiveCheck_gg(r9_diffuse_rs, width = 4, height = 2, bins=10)
plotPosteriorPredictors_ggplot(r9_diffuse_rs, width = 4, height = 3)
print(paste0("BF is ", BF_99c_rs))
if (BF_99c_rs[1] > 3) {
print("Random Slope + Intercept Model(Diffuse Prior) Support H3")
} else {
print("Random Slope + Intercept Model(Diffuse Prior) Does not Support H3")
}
print(summary(r9_diffuse))
posteriorPredictiveCheck_gg(r9_diffuse, width = 4, height = 2, bins=10)
plotPosteriorPredictors_ggplot(r9_diffuse, width = 4, height = 3)
print(summary(r9c_diffuse))
posteriorPredictiveCheck_gg(r9c_diffuse, width = 4, height = 2, bins=10)
print(paste0("BF is ", BF_99c))
if (BF_99c[1] > 3) {
print("Random Intercept Model(Diffuse Prior) Support H2")
} else {
print("Random Intercept Model(Diffuse Prior) Does not Support H2")
}
makePrior <- function(family = "beta", priorType = "d", interceptOnly = FALSE, randomSlope = FALSE) {
#----------------------------------------------------------
# ✅ Input hints and validation
#----------------------------------------------------------
allowed_families <- c("beta", "gamma")
allowed_prior_types <- c("d", "wi1", "wi2")
if (!family %in% allowed_families) {
stop(paste0(
"❌ Invalid 'family' argument.\n",
"Allowed values: ", paste(allowed_families, collapse = ", ")
))
}
if (!priorType %in% allowed_prior_types) {
stop(paste0(
"❌ Invalid 'priorType' argument.\n",
"Allowed values: ", paste(allowed_prior_types, collapse = ", ")
))
}
#----------------------------------------------------------
# ✅ Define all priors (copied from your definitions)
#----------------------------------------------------------
diffuse_priors_beta <- c(
set_prior("normal(0, 1000000)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(2, 0.1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative1_priors_beta <- c(
set_prior("normal(0, 100)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(10, 0.5)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative2_priors_beta <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(20, 1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
diffuse_priors_gamma <- c(
prior(normal(0, 1000000), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative1_priors_gamma <- c(
prior(normal(0, 100), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative2_priors_gamma <- c(
prior(normal(0, 1), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
#----------------------------------------------------------
# ✅ Select the correct prior set based on inputs
#----------------------------------------------------------
if (family == "beta") {
priors <- switch(priorType,
"d"   = diffuse_priors_beta,
"wi1" = weaklyInformative1_priors_beta,
"wi2" = weaklyInformative2_priors_beta)
} else if (family == "gamma") {
priors <- switch(priorType,
"d"   = diffuse_priors_gamma,
"wi1" = weaklyInformative1_priors_gamma,
"wi2" = weaklyInformative2_priors_gamma)
}
#----------------------------------------------------------
# ✅ Adjust prior list for model structure
#----------------------------------------------------------
if (isTRUE(interceptOnly)) {
# Remove priors for fixed effects and correlations
priors <- priors[!sapply(priors, function(p) p$class %in% c("b", "cor"))]
} else if (isTRUE(randomSlope)) {
# Remove only correlation priors
priors <- priors[!sapply(priors, function(p) p$class == "cor")]
}
#----------------------------------------------------------
# ✅ Return the final cleaned prior list
#----------------------------------------------------------
return(priors)
}
options(brms.verbose = FALSE)
### Random Intercept Only
r10_diffuse <- run_beta_regression(DQ_C_s ~ CC_c + (1 | participantID), makePrior())
makePrior <- function(family = "beta", priorType = "d", interceptOnly = FALSE, randomSlope = FALSE) {
#----------------------------------------------------------
# ✅ Input hints and validation
#----------------------------------------------------------
allowed_families <- c("beta", "gamma")
allowed_prior_types <- c("d", "wi1", "wi2")
if (!family %in% allowed_families) {
stop(paste0(
"❌ Invalid 'family' argument.\n",
"Allowed values: ", paste(allowed_families, collapse = ", ")
))
}
if (!priorType %in% allowed_prior_types) {
stop(paste0(
"❌ Invalid 'priorType' argument.\n",
"Allowed values: ", paste(allowed_prior_types, collapse = ", ")
))
}
#----------------------------------------------------------
# ✅ Define all priors (copied from your definitions)
#----------------------------------------------------------
diffuse_priors_beta <- c(
set_prior("normal(0, 1000000)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(2, 0.1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative1_priors_beta <- c(
set_prior("normal(0, 100)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(10, 0.5)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative2_priors_beta <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(20, 1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
diffuse_priors_gamma <- c(
prior(normal(0, 1000000), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative1_priors_gamma <- c(
prior(normal(0, 100), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative2_priors_gamma <- c(
prior(normal(0, 1), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
#----------------------------------------------------------
# ✅ Select the correct prior set based on inputs
#----------------------------------------------------------
if (family == "beta") {
priors <- switch(priorType,
"d"   = diffuse_priors_beta,
"wi1" = weaklyInformative1_priors_beta,
"wi2" = weaklyInformative2_priors_beta)
} else if (family == "gamma") {
priors <- switch(priorType,
"d"   = diffuse_priors_gamma,
"wi1" = weaklyInformative1_priors_gamma,
"wi2" = weaklyInformative2_priors_gamma)
}
#----------------------------------------------------------
# ✅ Adjust prior list for model structure
#----------------------------------------------------------
if (isTRUE(interceptOnly)) {
# Remove priors for fixed effects and correlations
priors <- priors[!sapply(priors, function(p) p$class %in% c("b", "cor"))]
} else if (isFALSE(randomSlope)) {
# Remove only correlation priors
priors <- priors[!sapply(priors, function(p) p$class == "cor")]
}
#----------------------------------------------------------
# ✅ Return the final cleaned prior list
#----------------------------------------------------------
return(priors)
}
options(brms.verbose = FALSE)
### Random Intercept Only
r10_diffuse <- run_beta_regression(DQ_C_s ~ CC_c + (1 | participantID), makePrior())
run_beta_regression <- function(formula,
prior,
fileName,
data = participant_data,
family = Beta(link = "logit"),
chains = 4,
iter = 2000,
warmup = 1000,
seed = 123,
control = list(adapt_delta = 0.95),
save_all_pars = TRUE,
silent = TRUE,
refresh = 0
) {
# Note: Iterations, warmup and chains are all default value
model <- brm(
formula = formula,
data = data,
family = family,
prior = prior,
chains = chains,
iter = iter,
warmup = warmup,
seed = seed,
control = control,
save_pars = if (save_all_pars) save_pars(all = TRUE) else NULL,
silent = silent,
refresh = refresh,
file = fileName
)
print(summary(model))
return(model)
}
run_beta_regression <- function(formula,
prior,
fileName,
data = participant_data,
family = Beta(link = "logit"),
chains = 4,
iter = 2000,
warmup = 1000,
seed = 123,
control = list(adapt_delta = 0.95),
save_all_pars = TRUE,
silent = TRUE,
refresh = 0
) {
# Note: Iterations, warmup and chains are all default value
model <- brm(
formula = formula,
data = data,
family = family,
prior = prior,
chains = chains,
iter = iter,
warmup = warmup,
seed = seed,
control = control,
save_pars = if (save_all_pars) save_pars(all = TRUE) else NULL,
silent = silent,
refresh = refresh,
file = paste0("R/models/",fileName)
)
print(summary(model))
return(model)
}
makePrior <- function(family = "beta", priorType = "d", interceptOnly = FALSE, randomSlope = FALSE) {
#----------------------------------------------------------
# ✅ Input hints and validation
#----------------------------------------------------------
allowed_families <- c("beta", "gamma")
allowed_prior_types <- c("d", "wi1", "wi2")
if (!family %in% allowed_families) {
stop(paste0(
"❌ Invalid 'family' argument.\n",
"Allowed values: ", paste(allowed_families, collapse = ", ")
))
}
if (!priorType %in% allowed_prior_types) {
stop(paste0(
"❌ Invalid 'priorType' argument.\n",
"Allowed values: ", paste(allowed_prior_types, collapse = ", ")
))
}
#----------------------------------------------------------
# ✅ Define all priors (copied from your definitions)
#----------------------------------------------------------
diffuse_priors_beta <- c(
set_prior("normal(0, 1000000)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(2, 0.1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative1_priors_beta <- c(
set_prior("normal(0, 100)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(10, 0.5)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
weaklyInformative2_priors_beta <- c(
set_prior("normal(0, 1)", class = "b"),
set_prior("normal(0, 1000000)", class = "Intercept"),
set_prior("cauchy(0, 1)", class = "sd", lb = 0),
set_prior("gamma(20, 1)", class = "phi"),
set_prior("lkj(1)", class = "cor")
)
diffuse_priors_gamma <- c(
prior(normal(0, 1000000), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative1_priors_gamma <- c(
prior(normal(0, 100), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
weaklyInformative2_priors_gamma <- c(
prior(normal(0, 1), class = "b"),
prior(normal(0, 1000000), class = "Intercept"),
prior(gamma(0.01, 0.01), class = "shape")
)
#----------------------------------------------------------
# ✅ Select the correct prior set based on inputs
#----------------------------------------------------------
if (family == "beta") {
priors <- switch(priorType,
"d"   = diffuse_priors_beta,
"wi1" = weaklyInformative1_priors_beta,
"wi2" = weaklyInformative2_priors_beta)
} else if (family == "gamma") {
priors <- switch(priorType,
"d"   = diffuse_priors_gamma,
"wi1" = weaklyInformative1_priors_gamma,
"wi2" = weaklyInformative2_priors_gamma)
}
#----------------------------------------------------------
# ✅ Adjust prior list for model structure
#----------------------------------------------------------
if (isTRUE(interceptOnly)) {
# Remove priors for fixed effects (class = "b") and correlations (class = "cor")
priors <- priors[!sapply(priors, function(p) {
is.list(p) && "class" %in% names(p) && p$class %in% c("b", "cor")
})]
} else if (isFALSE(randomSlope)) {
# Remove correlation priors only
priors <- priors[!sapply(priors, function(p) {
is.list(p) && "class" %in% names(p) && p$class == "cor"
})]
}
#----------------------------------------------------------
# ✅ Return the final cleaned prior list
#----------------------------------------------------------
return(priors)
}
options(brms.verbose = FALSE)
### Random Intercept Only
r10_diffuse <- run_beta_regression(DQ_C_s ~ CC_c + (1 | participantID), makePrior(), "r10_diffuse")
### Random Intercept Only
r10_diffuse <- run_beta_regression(DQ_C_s ~ CC_c + (1 | participantID), makePrior(), "r10_diffuse")
setwd("~/OneDrive - The University of Melbourne/Bayesian Updating and Complexity/Code/Analysis")
### Random Intercept Only
r10_diffuse <- run_beta_regression(DQ_C_s ~ CC_c + (1 | participantID), makePrior(), "r10_diffuse")
setwd("~/OneDrive - The University of Melbourne/Bayesian Updating and Complexity/Code/Analysis/R")
### Random Intercept Only
r10_diffuse <- run_beta_regression(DQ_C_s ~ CC_c + (1 | participantID), makePrior(), "r10_diffuse")
